<!doctype html><html lang="ms"><head>
<meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1">
<title>Pegawai • Hantar Minit Curai</title>
<link rel="stylesheet" href="./theme.css">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<script defer src="https://identity.netlify.com/v1/netlify-identity-widget.js"></script>
</head><body>
<div class="wrap">
  <header class="header">
    <div class="brand">
      <img src="/.netlify/functions/assets/logo.png" onerror="this.src='netlify/functions/assets/logo.png'">
      <div>
        <h1>PPD Mersing <small>Platform Minit Curai • Sektor Pembelajaran</small></h1>
      </div>
    </div>
    <div class="spacer"></div>
    <span id="whoami" class="badge hide"></span>
    <a id="btnLogin" class="btn btn-outline">Log Masuk</a>
    <a id="btnLogout" class="btn btn-outline hide">Log Keluar</a>
  </header>
  <main class="kid">

<section class="card card-pad">
  <div class="note">Isi semua medan wajib. Emel pegawai diambil automatik dari akaun yang log masuk.</div>
  <form id="f" class="form kid">
    <div class="row-2">
      <input class="input" name="tarikh" type="date" required>
      <input class="input" name="masa" placeholder="Masa" required>
    </div>
    <div class="row-2">
      <input class="input" name="tempat" placeholder="Tempat" required>
      <input class="input" name="tajuk" placeholder="Tajuk" required>
    </div>
    <textarea class="textarea" name="catatan" rows="4" placeholder="Catatan" required></textarea>
    <textarea class="textarea" name="tindakan_ppd" rows="3" placeholder="Tindakan PPD" required></textarea>
    <textarea class="textarea" name="rumusan" rows="3" placeholder="Rumusan" required></textarea>
    <div class="center">
      <button class="btn btn-primary" type="submit">Hantar kepada Timbalan</button>
      <a id="wa" class="btn btn-gold hide" target="_blank">WhatsApp Timbalan</a>
    </div>
  </form>
  <p id="ok" class="note hide">✅ Minit dihantar.</p>
</section>
<script>
if(!cu()){ alert('Sila log masuk dahulu.'); location.href='/' }
document.getElementById('f').addEventListener('submit', async(e)=>{
  e.preventDefault();
  const fd=new FormData(e.target); const p=Object.fromEntries(fd.entries());
  const r=await ap('/.netlify/functions/submit-minit',{method:'POST',body:JSON.stringify(p)});
  if(r.ok){ document.getElementById('ok').classList.remove('hide'); const a=document.getElementById('wa'); if(r.wa){ a.href=r.wa; a.classList.remove('hide'); } e.target.reset(); } else alert(r.error||'Gagal');
});
</script>

  </main>
  <p class="footer">© PPD Mersing • Tema rasmi biru–kuning</p>
</div>
<script>
function cu(){return netlifyIdentity&&netlifyIdentity.currentUser()}
async function tok(){const u=cu();return u?await u.token():null}
async function ap(path,opts={}){const t=await tok();opts.headers=Object.assign({'Content-Type':'application/json'},opts.headers||{});if(t)opts.headers.Authorization='Bearer '+t;const r=await fetch(path,opts);return r.json()}
const who=document.getElementById('whoami');const bIn=document.getElementById('btnLogin');const bOut=document.getElementById('btnLogout');
function upd(){const u=cu(); if(u){who.classList.remove('hide'); who.textContent=u.email; bIn.classList.add('hide'); bOut.classList.remove('hide');} else {who.classList.add('hide'); bIn.classList.remove('hide'); bOut.classList.add('hide');}}
bIn.addEventListener('click',()=>netlifyIdentity.open('login')); bOut.addEventListener('click',()=>netlifyIdentity.logout());
netlifyIdentity.on('init',upd); netlifyIdentity.on('login',()=>{upd(); location.reload()}); netlifyIdentity.on('logout',()=>{upd(); location.reload()}); netlifyIdentity.init();
</script>
</body></html>