<!doctype html><html lang="ms"><head>
<meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1">
<title>PPD Mersing • Minit Curai</title>
<link rel="stylesheet" href="./theme.css">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<script defer src="https://identity.netlify.com/v1/netlify-identity-widget.js"></script>
</head><body>
<div class="banner"></div>
<div class="wrap">
  <header class="header">
    <div class="brand">
      <img src="/logo.png" onerror="this.src='/.netlify/functions/assets/logo.png'">
      <div>
        <h1>PEJABAT PENDIDIKAN DAERAH MERSING</h1>
        <small>APLIKASI PEREKODAN MINIT CURAI • SEKTOR PEMBELAJARAN</small>
      </div>
    </div>
    <div class="spacer"></div>
    <span id="whoami" class="badge hide"></span>
    <a id="btnLogin" class="btn btn-outline">Log Masuk</a>
    <a id="btnLogout" class="btn btn-outline hide">Log Keluar</a>
  </header>
  <main class="kid">

<section id="hero" class="hero">
  <div id="loader" class="note" style="margin-bottom:8px">Memuatkan status log masuk…</div>
  <h2>Selamat datang</h2>
  <p>Sila <b>Log Masuk</b> untuk akses modul Admin, Pegawai & Pengesah.</p>
  <div class="center" style="margin-top:10px">
    <a class="btn btn-primary" onclick="netlifyIdentity.open('login')">Log Masuk</a>
  </div>
</section>

<section id="tiles" class="hide">
  <div class="grid grid-3">
    <a class="tile card" href="admin.html">
      <div class="title">ADMIN</div>
      <p>Urus pengguna, eksport CSV & audit.</p>
    </a>
    <a class="tile card" href="pegawai.html">
      <div class="title">PEGAWAI</div>
      <p>Isi & hantar minit curai.</p>
    </a>
    <a class="tile card" href="pengesah.html">
      <div class="title">PENGESAH (TIMBALAN)</div>
      <p>Sahkan minit & e‑mel PDF.</p>
    </a>
  </div>
</section>

<script>
(function showTiles(){
  const hero=document.getElementById('hero'), tiles=document.getElementById('tiles'), loader=document.getElementById('loader');
  function show(){ hero.classList.add('hide'); tiles.classList.remove('hide'); }
  function still(){ if(loader) loader.textContent='Sila log masuk untuk akses modul.'; }
  if (cu()) { show(); } else { still(); }
  // Auto-show sebaik sahaja login
  netlifyIdentity.on('login', () => { try{ netlifyIdentity.close(); }catch{} show(); });
  // Fallback: jika token siap lepas init, terus show
  netlifyIdentity.on('init', () => { if (cu()) show(); });
  // Fallback masa lembap: cuba lagi selepas 800ms
  setTimeout(() => { if (cu()) show(); }, 800);
})();
</script>

  </main>
</div>
<script>
function cu(){return netlifyIdentity&&netlifyIdentity.currentUser()}
async function tok(){const u=cu();return u?await u.token():null}
async function ap(path,opts={}){const t=await tok();opts.headers=Object.assign({'Content-Type':'application/json'},opts.headers||{});if(t)opts.headers.Authorization='Bearer '+t;const r=await fetch(path,opts);return r.json()}
const who=document.getElementById('whoami');const bIn=document.getElementById('btnLogin');const bOut=document.getElementById('btnLogout');
function upd(){
  const u=cu();
  if(u){
    who.classList.remove('hide'); who.textContent=u.email; bIn.classList.add('hide'); bOut.classList.remove('hide');
    // Tambah quick nav bila logged in (di header)
    if(!document.getElementById('quicknav')){
      const q=document.createElement('div'); q.id='quicknav'; q.style.marginRight='8px';
      q.innerHTML=`<a href="/admin.html" class="btn btn-outline" style="margin-right:6px">Admin</a>
                   <a href="/pegawai.html" class="btn btn-outline" style="margin-right:6px">Pegawai</a>
                   <a href="/pengesah.html" class="btn btn-outline">Pengesah</a>`;
      bIn.parentNode.insertBefore(q, bIn);
    }
  } else {
    who.classList.add('hide'); bIn.classList.remove('hide'); bOut.classList.add('hide');
    const q=document.getElementById('quicknav'); if(q) q.remove();
  }
}
bIn.addEventListener('click',()=>netlifyIdentity.open('login')); bOut.addEventListener('click',()=>netlifyIdentity.logout());
netlifyIdentity.on('init',upd); netlifyIdentity.on('login',()=>{upd(); location.reload()}); netlifyIdentity.on('logout',()=>{upd(); location.reload()}); netlifyIdentity.init();
</script>
</body></html>